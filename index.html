<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OrbitGuard: 面向航天遥感目标检测模型的可靠性评估与漏洞对抗系统</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
<style>
body {
font-family: 'Space Grotesk', sans-serif;
background: linear-gradient(135deg, #1a1f35 0%, #283045 100%);
color: #fff;
}
@keyframes fade-in {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
.animate-fade-in {
animation: fade-in 0.3s ease-out forwards;
}
.tech-border {
position: relative;
overflow: hidden;
border: 1px solid rgba(59, 130, 246, 0.3);
}
.tech-card {
background: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
}
.tech-glow {
box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
}
</style>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
primary: '#3b82f6',
secondary: '#1e40af'
},
borderRadius: {
'none': '0px',
'sm': '4px',
DEFAULT: '8px',
'md': '12px',
'lg': '16px',
'xl': '20px',
'2xl': '24px',
'3xl': '32px',
'full': '9999px',
'button': '8px'
}
}
}
}
</script>
<style>
:where([class^="ri-"])::before {
content: "\f3c2";
}
</style>
</head>
<body class="min-h-screen">
<!-- 顶部标题区域 -->
<div class="relative overflow-hidden">
<div class="absolute inset-0">
<img src="./figure/卫星地球图像.jpg"
class="w-full h-full object-cover opacity-20" alt="背景">
</div>
<div class="max-w-7xl mx-auto px-6 py-12 relative">
<h1 class="text-4xl font-bold text-center mb-8 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-blue-600">
OrbitGuard: 面向航天遥感目标检测模型的可靠性评估与漏洞对抗系统
</h1>
<div class="absolute -top-20 -left-20 w-40 h-40 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
<div class="absolute -top-20 -right-20 w-40 h-40 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
<!-- 航天-威胁-检测-修复（Inline SVG 流程图，箭头加粗加大、纯白；黄色全部改为蓝色系） -->
<div class="tech-card tech-border rounded-xl p-8 mb-8 tech-glow">
  <h2 class="text-2xl font-semibold text-center text-blue-400 mb-6">YOLO 模型流程图</h2>
  <div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-6 backdrop-blur-sm border border-[rgba(255,255,255,0.1)]">
    <svg viewBox="0 0 1200 420" width="100%" height="100%" role="img" aria-label="航天场景定义 → 威胁模型构建 → 漏洞检测方案 → 漏洞修复模型">
      <defs>
        <style>
          .col { rx:16; ry:16; stroke-width:2; }
          .hdr { font: 700 20px/1.2 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto; fill:#111827; }
          .item { rx:10; ry:10; }
          .itxt { font: 600 16px/1.2 ui-sans-serif, system-ui; fill:#111827; }
          .arrow { fill:#ffffff; stroke:#ffffff; stroke-width:2; opacity:1; }
        </style>
      </defs>

      <!-- 列1：航天场景定义（蓝） -->
      <g transform="translate(40,40)">
        <rect class="col" width="250" height="330" fill="#dbeafe" stroke="#60a5fa"/>
        <text class="hdr" x="125" y="40" text-anchor="middle">航天场景定义</text>

        <rect class="item" x="20" y="80"  width="210" height="56" fill="#93c5fd"/>
        <text class="itxt" x="125" y="115" text-anchor="middle" fill="#0f172a">遥感识别与感知任务</text>

        <rect class="item" x="20" y="150" width="210" height="56" fill="#93c5fd"/>
        <text class="itxt" x="125" y="185" text-anchor="middle" fill="#0f172a">太空复杂、极端环境</text>

        <rect class="item" x="20" y="220" width="210" height="56" fill="#93c5fd"/>
        <text class="itxt" x="125" y="255" text-anchor="middle" fill="#0f172a">实时性要求严格</text>
      </g>

      <!-- 加粗加大的白色箭头1 -->
      <g transform="translate(292,186)">
        <!-- 宽度约120，高度约56 -->
        <path class="arrow" d="M0,0 h40 v-28 l80,28 l-80,28 v-28 h-40 z"></path>
      </g>

      <!-- 列2：威胁模型构建（由黄改蓝） -->
      <g transform="translate(330,40)">
        <rect class="col" width="250" height="330" fill="#dbeafe" stroke="#60a5fa"/>
        <text class="hdr" x="125" y="40" text-anchor="middle">威胁模型构建</text>

        <rect class="item" x="20" y="80"  width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="115" text-anchor="middle">目标误判漏洞</text>

        <rect class="item" x="20" y="150" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="185" text-anchor="middle">位翻转漏洞</text>

        <rect class="item" x="20" y="220" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="255" text-anchor="middle">延迟攻击漏洞</text>
      </g>

      <!-- 加粗加大的白色箭头2 -->
      <g transform="translate(582,186)">
        <path class="arrow" d="M0,0 h40 v-28 l80,28 l-80,28 v-28 h-40 z"></path>
      </g>

      <!-- 列3：漏洞检测方案（蓝） -->
      <g transform="translate(620,40)">
        <rect class="col" width="250" height="330" fill="#dbeafe" stroke="#60a5fa"/>
        <text class="hdr" x="125" y="40" text-anchor="middle">漏洞检测方案</text>

        <rect class="item" x="20" y="80" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="103" text-anchor="middle">基于对抗攻击的目标</text>
        <text class="itxt" x="125" y="123" text-anchor="middle">误判漏洞检测</text>

        <rect class="item" x="20" y="150" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="173" text-anchor="middle">基于渐进搜索的位翻</text>
        <text class="itxt" x="125" y="193" text-anchor="middle">转漏洞检测</text>

        <rect class="item" x="20" y="220" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="243" text-anchor="middle">基于延迟攻击的实时</text>
        <text class="itxt" x="125" y="263" text-anchor="middle">算法漏洞检测</text>
      </g>

      <!-- 加粗加大的白色箭头3 -->
      <g transform="translate(872,186)">
        <path class="arrow" d="M0,0 h40 v-28 l80,28 l-80,28 v-28 h-40 z"></path>
      </g>

      <!-- 列4：漏洞修复模型（由黄改蓝） -->
      <g transform="translate(910,40)">
        <rect class="col" width="250" height="330" fill="#dbeafe" stroke="#60a5fa"/>
        <text class="hdr" x="125" y="40" text-anchor="middle">漏洞修复模型</text>

        <rect class="item" x="20" y="80" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="103" text-anchor="middle">基于对抗性训练的目</text>
        <text class="itxt" x="125" y="123" text-anchor="middle">标识别漏洞修复</text>

        <rect class="item" x="20" y="150" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="173" text-anchor="middle">基于二值感知训练的</text>
        <text class="itxt" x="125" y="193" text-anchor="middle">位翻转漏洞修复</text>

        <rect class="item" x="20" y="220" width="210" height="56" fill="#bfdbfe"/>
        <text class="itxt" x="125" y="243" text-anchor="middle">基于背景感知对抗训</text>
        <text class="itxt" x="125" y="263" text-anchor="middle">练的时延漏洞修复</text>
      </g>
    </svg>
  </div>
</div>

<!-- 模型下载区域 -->
<div class="text-center">
  <div class="inline-flex items-center gap-4">
    <span class="text-lg text-white">下载 yolov8.pt 文件：</span>

    <button id="downloadBtn" type="button"
      class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap inline-flex items-center gap-2">
      <span class="w-5 h-5 flex items-center justify-center">
        <!-- 静态下载图标 -->
        <i id="dlIcon" class="ri-download-line"></i>
        <!-- 下载中旋转图标（默认隐藏） -->
        <svg id="dlSpinner" class="hidden animate-spin" viewBox="0 0 24 24" width="18" height="18" fill="none">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="3" opacity=".25"></circle>
          <path d="M21 12a9 9 0 0 0-9-9" stroke="currentColor" stroke-width="3"></path>
        </svg>
      </span>
      下载
    </button>
  </div>
</div>

<script>
  (function () {
    const btn = document.getElementById('downloadBtn');
    const icon = document.getElementById('dlIcon');
    const spinner = document.getElementById('dlSpinner');

    btn?.addEventListener('click', () => {
      // UI: 禁用 + 显示旋转图标
      btn.disabled = true;
      btn.classList.add('opacity-80', 'cursor-not-allowed');
      if (icon) icon.classList.add('hidden');
      if (spinner) spinner.classList.remove('hidden');

      // 触发下载（同源静态资源需确保可被服务器直接访问）
      const a = document.createElement('a');
      a.href = './src/yolov8.pt';
      a.download = 'yolov8.pt';
      document.body.appendChild(a);
      a.click();
      a.remove();

      // 简单复位 UI（下载会在浏览器继续进行）
      setTimeout(() => {
        btn.disabled = false;
        btn.classList.remove('opacity-80', 'cursor-not-allowed');
        if (icon) icon.classList.remove('hidden');
        if (spinner) spinner.classList.add('hidden');
      }, 800);
    });
  })();
</script>

<!-- 功能模块区域 -->
<div class="max-w-7xl mx-auto px-6 py-12">
<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<!-- 场景一 -->
<div class="tech-card tech-border rounded-xl p-8 transform hover:scale-105 transition-transform duration-300 backdrop-blur-md bg-white/5 hover:border-blue-400 transition-colors">
<div class="absolute top-4 right-4">
<div class="w-8 h-8 flex items-center justify-center">
<i class="ri-radar-line text-blue-400"></i>
</div>
</div>
<h3 class="text-xl font-semibold text-blue-400 mb-6 text-center">卫星目标误判漏洞对抗</h3>
<div class="mb-8">
<p class="text-gray-300 leading-relaxed mb-4">
目标误判漏洞对抗，通过利用对抗样本攻击算法在图像上添加微小扰动，模拟航天遥感图像识别可能面临的多源复合噪声，检测目标模型是否易发生目标误判。
</p>
<p class="text-gray-400 leading-relaxed">
<strong class="text-blue-300">测试算法的创新点：</strong>采用梯度引导的扰动生成方法，能够在少量数据依赖下生成通用对抗样本，实现在黑盒条件下的对抗攻击，有效检测目标误判漏洞。
</p>
</div>
<div class="flex gap-4 justify-center">
<button class="scenario-detect-btn bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap" data-scenario="1">
检测
</button>
<button class="scenario-repair-btn bg-green-600 text-white px-6 py-3 !rounded-button hover:bg-green-700 transition-colors whitespace-nowrap" data-scenario="1">
修复
</button>


</div>
</div>
<!-- 场景二 -->
<div class="tech-card tech-border rounded-xl p-8 transform hover:scale-105 transition-transform duration-300 backdrop-blur-md bg-white/5 hover:border-blue-400 transition-colors">
<div class="absolute top-4 right-4">
<div class="w-8 h-8 flex items-center justify-center">
<i class="ri-shield-flash-line text-blue-400"></i>
</div>
</div>
<h3 class="text-xl font-semibold text-blue-400 mb-6 text-center">参数位翻转漏洞对抗</h3>
<div class="mb-8">
<p class="text-gray-300 leading-relaxed mb-4">
模型参数位翻转攻击检测，通过翻转神经网络权重参数的特定位，模拟硬件故障对模型推理的影响。
</p>
<p class="text-gray-400 leading-relaxed">
<strong class="text-blue-300">测试算法的创新点：</strong>基于梯度排序评分的位翻转策略，能够精确定位对模型性能影响最大的关键参数位置。
</p>
</div>
<div class="flex gap-4 justify-center">
<button class="scenario-detect-btn bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap" data-scenario="2">
检测
</button>
<button class="scenario-repair-btn bg-green-600 text-white px-6 py-3 !rounded-button hover:bg-green-700 transition-colors whitespace-nowrap" data-scenario="2">
修复
</button>


</div>
</div>
<!-- 场景三 -->
<div class="tech-card tech-border rounded-xl p-8 transform hover:scale-105 transition-transform duration-300 backdrop-blur-md bg-white/5 hover:border-blue-400 transition-colors">
<div class="absolute top-4 right-4">
<div class="w-8 h-8 flex items-center justify-center">
<i class="ri-timer-flash-line text-blue-400"></i>
</div>
</div>
<h3 class="text-xl font-semibold text-blue-400 mb-6 text-center">推理时延漏洞对抗</h3>
<div class="mb-8">
<p class="text-gray-300 leading-relaxed mb-4">
推理时间延迟攻击检测，通过注入计算复杂度高的恶意样本，导致模型推理时间显著增加。
</p>
<p class="text-gray-400 leading-relaxed">
<strong class="text-blue-300">测试算法的创新点：</strong>结合时间复杂度分析和资源消耗监控，能够识别并量化推理延迟攻击的严重程度。
</p>
</div>
<div class="flex gap-4 justify-center">
<button class="scenario-detect-btn bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap" data-scenario="3">
检测
</button>
<button class="scenario-repair-btn bg-green-600 text-white px-6 py-3 !rounded-button hover:bg-green-700 transition-colors whitespace-nowrap" data-scenario="3">
修复
</button>


</div>
</div>
</div>
</div>
<!-- 检测结果弹窗 -->
<div id="detectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
<div class="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
<div class="p-8">
<div class="flex justify-between items-center mb-6">
<h3 id="detectModalTitle" class="text-2xl font-semibold text-gray-900">检测结果</h3>
<button id="closeDetectModal" class="text-gray-500 hover:text-gray-700">
<div class="w-6 h-6 flex items-center justify-center">
<i class="ri-close-line ri-lg"></i>
</div>
</button>
</div>
<div id="detectModalContent" class="text-gray-700">
<!-- 动态内容 -->
</div>
</div>
</div>
</div>
<!-- 修复结果弹窗 -->
<div id="repairModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
<div class="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
<div class="p-8">
<div class="flex justify-between items-center mb-6">
<h3 id="repairModalTitle" class="text-2xl font-semibold text-gray-900">修复结果</h3>
<button id="closeRepairModal" class="text-gray-500 hover:text-gray-700">
<div class="w-6 h-6 flex items-center justify-center">
<i class="ri-close-line ri-lg"></i>
</div>
</button>
</div>
<div id="repairModalContent" class="text-gray-700">
<!-- 动态内容 -->
</div>
</div>
</div>
</div>
<script id="download-handler">
document.addEventListener('DOMContentLoaded', function() {
const downloadBtn = document.getElementById('downloadBtn');
downloadBtn.addEventListener('click', function() {
// 模拟文件下载
const link = document.createElement('a');
link.href = '#';
link.download = 'yolov8.pt';
link.textContent = 'yolov8.pt';
// 创建临时提示
const originalText = downloadBtn.innerHTML;
downloadBtn.innerHTML = '<div class="w-5 h-5 flex items-center justify-center"><i class="ri-check-line"></i></div>下载中...';
downloadBtn.disabled = true;
setTimeout(() => {
downloadBtn.innerHTML = originalText;
downloadBtn.disabled = false;
alert('yolov8.pt 文件下载完成！');
}, 2000);
});
});
</script>
<script id="modal-handlers">
document.addEventListener('DOMContentLoaded', function() {
const detectModal = document.getElementById('detectModal');
const repairModal = document.getElementById('repairModal');
const closeDetectModal = document.getElementById('closeDetectModal');
const closeRepairModal = document.getElementById('closeRepairModal');
// 关闭弹窗事件
closeDetectModal.addEventListener('click', () => {
detectModal.classList.add('hidden');
});
closeRepairModal.addEventListener('click', () => {
repairModal.classList.add('hidden');
});
// 点击背景关闭弹窗
detectModal.addEventListener('click', (e) => {
if (e.target === detectModal) {
detectModal.classList.add('hidden');
}
});
repairModal.addEventListener('click', (e) => {
if (e.target === repairModal) {
repairModal.classList.add('hidden');
}
});
});
</script>
<script id="scenario-handlers">
document.addEventListener('DOMContentLoaded', function() {
const detectBtns = document.querySelectorAll('.scenario-detect-btn');
const repairBtns = document.querySelectorAll('.scenario-repair-btn');
// 检测按钮事件
detectBtns.forEach(btn => {
btn.addEventListener('click', function() {
const scenario = this.getAttribute('data-scenario');
showDetectResult(scenario);
});
});
// 修复按钮事件
repairBtns.forEach(btn => {
btn.addEventListener('click', function() {
const scenario = this.getAttribute('data-scenario');
showRepairResult(scenario);
});
});
function showDetectResult(scenario) {
const modal = document.getElementById('detectModal');
const title = document.getElementById('detectModalTitle');
const content = document.getElementById('detectModalContent');
title.textContent = `场景${scenario}检测结果`;
if (scenario === '1') {
// 场景1：对抗样本干扰可视化
content.innerHTML = `
<div class="space-y-6">

  <!-- 可视化区 -->
  <div class="rounded-xl p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <h4 class="text-lg font-semibold text-blue-900">对抗样本干扰可视化</h4>
      <span class="text-[11px] px-2 py-1 rounded-full bg-blue-100 text-blue-800 ring-1 ring-blue-200">Scenario 1</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <figure class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <img src="./figure/场景1_1.png" alt="原始图像"
             class="w-full h-64 object-contain bg-gray-50">
        <figcaption class="text-xs text-gray-600 px-3 py-2 border-t">原始图像</figcaption>
      </figure>
      <figure class="bg-white border border-gray-200 rounded-lg overflow-hidden">
        <img src="./figure/场景1_2.png" alt="对抗样本"
             class="w-full h-64 object-contain bg-gray-50">
        <figcaption class="text-xs text-gray-600 px-3 py-2 border-t">对抗样本（叠加扰动）</figcaption>
      </figure>
    </div>
  </div>

  <!-- 指标总览 -->
  <div class="rounded-xl p-6 bg-white border border-gray-100 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <h4 class="text-lg font-semibold text-gray-900">攻击效果分析</h4>
      <span class="text-[11px] px-2 py-1 rounded-full bg-red-100 text-red-700 ring-1 ring-red-200">高影响</span>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- ε -->
      <div class="rounded-lg p-4 border border-gray-100 bg-gray-50">
        <p class="text-xs text-gray-500 mb-1">平均扰动强度</p>
        <p class="text-2xl font-bold text-gray-900">ε = 0.167</p>
        <div class="mt-2 h-1.5 w-full bg-gray-200 rounded">
          <div class="h-1.5 bg-gray-500 rounded" style="width: 33%"></div>
        </div>
        <p class="text-[11px] text-gray-400 mt-1">相对 ε∈[0,0.5] 归一化示意</p>
      </div>

      <!-- mAP 下降 -->
      <div class="rounded-lg p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">检测精度下降</p>
        <p class="text-2xl font-bold text-red-600">59.58<span class="text-base text-gray-500 ml-1">%</span></p>
        <div class="mt-2 h-1.5 w-full bg-red-100 rounded">
          <div class="h-1.5 bg-red-500 rounded" style="width: 59.58%"></div>
        </div>
        <p class="text-[11px] text-gray-400 mt-1">相对未攻击基线</p>
      </div>

      <!-- 攻击成功率 -->
      <div class="rounded-lg p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">攻击成功率</p>
        <p class="text-2xl font-bold text-red-600">59.81<span class="text-base text-gray-500 ml-1">%</span></p>
        <div class="mt-2 h-1.5 w-full bg-red-100 rounded">
          <div class="h-1.5 bg-red-500 rounded" style="width: 59.81%"></div>
        </div>
        <p class="text-[11px] text-gray-400 mt-1">越高代表攻击越有效</p>
      </div>

      <!-- SSIM -->
      <div class="rounded-lg p-4 border border-gray-100">
        <p class="text-xs text-gray-500 mb-1">视觉不可察觉性</p>
        <p class="text-2xl font-bold text-emerald-600">0.98<span class="text-base text-gray-500 ml-1">SSIM</span></p>
        <div class="mt-2 h-1.5 w-full bg-emerald-100 rounded">
          <div class="h-1.5 bg-emerald-500 rounded" style="width: 98%"></div>
        </div>
        <p class="text-[11px] text-gray-400 mt-1">数值越接近 1 越不易察觉</p>
      </div>
    </div>
  </div>

  <!-- 解释说明 -->
  <div class="rounded-xl p-4 bg-gray-50 border border-gray-100">
    <details class="group">
      <summary class="cursor-pointer list-none flex items-center justify-between">
        <span class="text-sm font-medium text-gray-800">说明与建议</span>
        <svg class="w-4 h-4 text-gray-500 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06.02L10 11.17l3.71-3.94a.75.75 0 011.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
      </summary>
      <div class="mt-3 text-sm text-gray-700 space-y-1">
        <p>• mAP 下降与攻击成功率均较高，说明对目标检测性能影响显著。</p>
        <p>• SSIM≈0.98 表明人眼难以察觉扰动，适合展示“隐蔽但有效”的攻击特征。</p>
        <p>• 建议：在推理前增加输入检测（如频域统计、低秩投影）与自适应降噪。</p>
      </div>
    </details>
  </div>

</div>
`;

} else if (scenario === '2') {
// 场景2：数据结果（新增两项 mAP 指标）
const data = {
  title: '位翻转攻击检测结果',
  flipCount: 4,
  timeIncrease: '3.7s',
  map50Drop: 22.5,     // mAP@.5 下降（百分比数值）
  map5095Drop: 16.8,   // mAP@.5:.95 下降（百分比数值）
  positions: [
    '网络层: backbone.0.conv, 权重索引: [12, 3, 2, 2], 攻击前权重: 0.0390625, 攻击后权重: -0.9609375', 
    '网络层: backbone.2.conv, 权重索引: [54, 15, 1, 0], 攻击前权重: -0.0703125, 攻击后权重: 0.8671875', 
    '网络层: head.detect.m.0.conv, 权重索引: [128, 32, 0, 1], 攻击前权重: 0.015625, 攻击后权重: -0.984375',
    '网络层: head.detect.m.2.conv, 权重索引: [256, 128, 1, 1], 攻击前权重: -0.0078125, 攻击后权重: 0.9921875'
  ]
};

// 影响等级（用于 badge 与配色）
const impactLevel = data.map50Drop >= 20 ? '高影响' : (data.map50Drop >= 10 ? '中等影响' : '低影响');
const impactColor = data.map50Drop >= 20 ? 'bg-red-100 text-red-700 ring-red-200' :
                    data.map50Drop >= 10 ? 'bg-yellow-100 text-yellow-800 ring-yellow-200' :
                    'bg-emerald-100 text-emerald-700 ring-emerald-200';

// 进度条宽度（按下降百分比可视化）
const barW50 = Math.min(Math.max(data.map50Drop, 0), 100);
const barW5095 = Math.min(Math.max(data.map5095Drop, 0), 100);

content.innerHTML = `
<div class="space-y-6">
  <!-- 标题区 -->
  <div class="rounded-xl p-6 bg-gradient-to-r from-yellow-50 via-amber-50 to-orange-50 border border-amber-100">
    <div class="flex items-center justify-between mb-2">
      <h4 class="text-lg font-semibold text-amber-900">${data.title}</h4>
      <span class="text-xs px-2 py-1 rounded-full ring-1 ${impactColor}">${impactLevel}</span>
    </div>
    <p class="text-sm text-amber-800/80">对模型精度造成明显影响，建议进行权重校验与推理前完整性检查。</p>
  </div>

  <!-- 指标总览 -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="rounded-xl p-4 bg-white border border-gray-100 shadow-sm">
      <p class="text-xs text-gray-500 mb-1">位翻转次数</p>
      <p class="text-2xl font-bold text-amber-700">${data.flipCount}</p>
      <p class="text-[11px] text-gray-400 mt-1">检测到的权重翻转事件</p>
    </div>
    <div class="rounded-xl p-4 bg-white border border-gray-100 shadow-sm">
      <p class="text-xs text-gray-500 mb-1">检测耗时</p>
      <p class="text-2xl font-bold text-amber-700">${data.timeIncrease}</p>
      <p class="text-[11px] text-gray-400 mt-1">包含定位与比对开销</p>
    </div>
    <div class="rounded-xl p-4 bg-white border border-gray-100 shadow-sm">
      <p class="text-xs text-gray-500 mb-1">mAP@.5 下降</p>
      <p class="text-2xl font-bold text-red-600">${data.map50Drop}%</p>
      <div class="mt-2 h-1.5 w-full bg-red-100 rounded">
        <div class="h-1.5 rounded bg-red-500" style="width:${barW50}%"></div>
      </div>
    </div>
    <div class="rounded-xl p-4 bg-white border border-gray-100 shadow-sm">
      <p class="text-xs text-gray-500 mb-1">mAP@.5:.95 下降</p>
      <p class="text-2xl font-bold text-red-600">${data.map5095Drop}%</p>
      <div class="mt-2 h-1.5 w-full bg-orange-100 rounded">
        <div class="h-1.5 rounded bg-orange-500" style="width:${barW5095}%"></div>
      </div>
    </div>
  </div>

  <!-- 影响分析 -->
  <div class="rounded-xl p-6 bg-orange-50 border border-orange-100">
    <h5 class="text-base font-semibold mb-3 text-orange-900">性能影响分析</h5>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="rounded-lg p-4 bg-white border border-orange-100">
        <p class="text-xs text-gray-500 mb-1">推理延迟（检测阶段）</p>
        <p class="text-xl font-bold text-orange-700">${data.timeIncrease}</p>
        <p class="text-[11px] text-gray-400 mt-1">单次检测额外开销</p>
      </div>
      <div class="rounded-lg p-4 bg-white border border-orange-100">
        <p class="text-xs text-gray-500 mb-1">精度稳定性</p>
        <p class="text-sm text-gray-700">mAP 降幅在不同 IoU 阈值下均明显</p>
        <div class="mt-2 flex gap-2">
          <span class="text-[11px] px-2 py-0.5 rounded-full bg-red-50 text-red-700 ring-1 ring-red-100">@.5 -${data.map50Drop}%</span>
          <span class="text-[11px] px-2 py-0.5 rounded-full bg-orange-50 text-orange-700 ring-1 ring-orange-100">@.5:.95 -${data.map5095Drop}%</span>
        </div>
      </div>
      <div class="rounded-lg p-4 bg-white border border-orange-100">
        <p class="text-xs text-gray-500 mb-1">建议</p>
        <ul class="text-sm text-gray-700 list-disc pl-5 space-y-1">
          <li>对权重量化位进行奇偶校验/CRC 校验</li>
          <li>部署推理前快速校验与异常回滚</li>
          <li>关键层（det/head）添加冗余校验集</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- ✅ 新增：漏洞传播路径可视化 -->
  <div data-viz="vuln-path" class="max-w-4xl mx-auto px-6 py-12">
    <div class="rounded-xl p-8 border border-white/10 backdrop-blur-sm bg-white/5">
      <h2 class="text-2xl font-semibold text-center text-blue-400 mb-6">漏洞传播路径可视化</h2>
      <div class="flex flex-col items-center gap-6">
        <div class="w-full h-[400px] relative rounded-xl p-4 border border-white/10 bg-white/5 backdrop-blur-sm">
          <svg data-role="network-svg" class="w-full h-full"></svg>
        </div>
        <button data-role="start-btn" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition">
          <span class="mr-2">▶</span>开始演示
        </button>
      </div>
    </div>
  </div>

  <!-- 位翻转具体位置 -->
  <div class="rounded-xl p-6 bg-gray-50 border border-gray-100">
    <div class="flex items-center justify-between mb-3">
      <h5 class="text-base font-semibold text-gray-900">位翻转具体位置</h5>
      <span class="text-xs text-gray-500">共 ${data.flipCount} 处</span>
    </div>
    <ul class="space-y-2">
      ${data.positions.map(pos => `
        <li class="text-sm text-gray-700 bg-white p-3 rounded-lg border border-gray-200 hover:border-blue-300 transition">
          <span class="inline-block w-2 h-2 rounded-full bg-blue-400 mr-2 align-middle"></span>${pos}
        </li>
      `).join('')}
    </ul>
  </div>
</div>
`;

// 下面放的是渲染场景二漏洞触发流程的代码
// 2) 在 innerHTML 设置完成后，初始化可视化（不要把脚本写进 innerHTML）
mountVulnPathViz(content.querySelector('[data-viz="vuln-path"]'));

// 3) 挂载函数：把你给的脚本改成可复用的函数（基于容器元素查询，不用全局 ID）
function mountVulnPathViz(rootEl) {
  if (!rootEl) return;
  const svg = rootEl.querySelector('[data-role="network-svg"]');
  const btn = rootEl.querySelector('[data-role="start-btn"]');
  if (!svg || !btn) return;

  // 尺寸（可改为自适应容器宽度）
  const width = Math.max(720, rootEl.clientWidth - 64);
  const height = 370;
  svg.setAttribute('width', width);
  svg.setAttribute('height', height);
  // 清空旧图层（防止重复挂载）
  while (svg.firstChild) svg.removeChild(svg.firstChild);

  // 网络层定义
  const layers = [
    { nodes: 3, x: width * 0.05 },  // Input
    { nodes: 4, x: width * 0.15 },
    { nodes: 5, x: width * 0.25 },
    { nodes: 6, x: width * 0.35 },
    { nodes: 6, x: width * 0.45 },
    { nodes: 6, x: width * 0.55 },
    { nodes: 5, x: width * 0.65 },
    { nodes: 4, x: width * 0.75 },
    { nodes: 2, x: width * 0.85 }   // Output
  ];

  const nodeRadius = 15;
  const normalColor = 'rgba(255, 255, 255, 0.9)';
  const vulnerableColor = '#ff4444';
  const lineColor = 'rgba(100, 100, 100, 0.3)';
  const vulnerableLineColor = 'rgba(255, 0, 0, 0.5)';

  let nodes = [], connections = [];

  function createSvgElement(tag, attrs) {
    const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
    for (const [k, v] of Object.entries(attrs)) el.setAttribute(k, v);
    return el;
  }

  function createNode(x, y, layer, index) {
    const g = createSvgElement('g', { transform: `translate(${x},${y})` });
    const outer = createSvgElement('circle', { r: nodeRadius, fill: normalColor, stroke: '#666', 'stroke-width': 2 });
    const inner = createSvgElement('circle', { r: nodeRadius * 0.7, fill: 'white' });
    g.appendChild(outer);
    g.appendChild(inner);
    svg.appendChild(g);
    return { x, y, layer, index, outer, inner };
  }

  function createConnection(from, to) {
    const line = createSvgElement('line', { x1: from.x, y1: from.y, x2: to.x, y2: to.y, stroke: lineColor, 'stroke-width': 1 });
    svg.insertBefore(line, svg.firstChild);
    return { from, to, line };
  }

  function initializeNetwork() {
    nodes = [];
    connections = [];
    layers.forEach((layer, layerIndex) => {
      const layerNodes = [];
      const spacing = 60;
      const offsetY = (height - (layer.nodes - 1) * spacing) / 2;
      for (let i = 0; i < layer.nodes; i++) {
        const node = createNode(layer.x, offsetY + i * spacing, layerIndex, i);
        layerNodes.push(node);
      }
      if (layerIndex > 0) {
        nodes[layerIndex - 1].forEach(from => {
          layerNodes.forEach(to => connections.push(createConnection(from, to)));
        });
      }
      nodes.push(layerNodes);
    });
  }

  function resetNetwork() {
    nodes.flat().forEach(n => {
      n.outer.setAttribute('fill', normalColor);
      n.inner.setAttribute('fill', 'white');
    });
    connections.forEach(c => {
      c.line.setAttribute('stroke', lineColor);
      c.line.setAttribute('stroke-width', '1');
    });
  }

  function highlightVulnerabilityPath() {
    resetNetwork();
    let currentLayer = 0;
    const vulnerableNodes = [];

    function animateLayer() {
      if (currentLayer >= nodes.length) return;
      const current = nodes[currentLayer];
      const affected = current.filter(() => Math.random() < 0.6); // 可调命中率
      vulnerableNodes[currentLayer] = affected;

      affected.forEach(n => {
        n.outer.setAttribute('fill', vulnerableColor);
        n.inner.setAttribute('fill', '#ffcccc');
      });

      if (currentLayer > 0) {
        connections.forEach(conn => {
          if (vulnerableNodes[conn.from.layer]?.includes(conn.from) &&
              vulnerableNodes[conn.to.layer]?.includes(conn.to)) {
            conn.line.setAttribute('stroke', vulnerableLineColor);
            conn.line.setAttribute('stroke-width', '2');
          }
        });
      }
      currentLayer++;
      setTimeout(animateLayer, 500);
    }
    animateLayer();
  }

  // 初始化与事件
  initializeNetwork();
  btn.addEventListener('click', function () {
    btn.disabled = true;
    const old = btn.innerHTML;
    btn.innerHTML = `<span class="animate-pulse mr-2">⏳</span>演示中...`;
    highlightVulnerabilityPath();
    setTimeout(() => {
      btn.disabled = false;
      btn.innerHTML = old;
    }, nodes.length * 500 + 500);
  });

  // 可选：窗口尺寸变化时自适应（简单重绘）
  const onResize = () => {
    // 重新设置尺寸并重绘
    const w = Math.max(720, rootEl.clientWidth - 64);
    svg.setAttribute('width', w);
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    initializeNetwork();
  };
  // 可根据需要启用
  // window.addEventListener('resize', onResize);
}

} else if (scenario === '3') {
content.innerHTML = `
<div class="space-y-6">
  <!-- 可视化 -->
  <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
    <h4 class="text-lg font-semibold mb-4 text-blue-900">延迟攻击样本可视化</h4>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <p class="text-sm text-gray-600 mb-2">原始图像</p>
        <img src="./figure/场景3_1.jpg" alt="原始图像" class="w-full rounded-lg border border-blue-100">
      </div>
      <div>
        <p class="text-sm text-gray-600 mb-2">叠加 UAP 图像</p>
        <img src="./figure/场景3_2.jpg" alt="叠加 UAP 的对抗样本图像" class="w-full rounded-lg border border-blue-100">
      </div>
    </div>
  </div>

  <!-- 攻击效果分析（指标总览） -->
  <div class="bg-red-50 p-6 rounded-xl border border-red-100">
    <div class="flex items-center justify-between mb-4">
      <h4 class="text-lg font-semibold text-red-900">攻击效果分析</h4>
      <span class="text-xs px-2 py-1 rounded-full bg-red-100 text-red-700 ring-1 ring-red-200">高影响</span>
    </div>

    <!-- 指标卡片 -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="rounded-lg p-4 bg-white border border-gray-100 shadow-sm">
        <p class="text-xs text-gray-500 mb-1">原推理时延</p>
        <p class="text-2xl font-bold text-gray-900">10.14<span class="text-base font-medium text-gray-500 ml-1">ms</span></p>
        <p class="text-[11px] text-gray-400 mt-1">基线（无 Overload）</p>
      </div>
      <div class="rounded-lg p-4 bg-white border border-gray-100 shadow-sm">
        <p class="text-xs text-gray-500 mb-1">Overload 后时延</p>
        <p class="text-2xl font-bold text-red-600">42.89<span class="text-base font-medium text-gray-500 ml-1">ms</span></p>
        <p class="text-[11px] text-gray-400 mt-1">开启 Overload 条件</p>
      </div>
      <div class="rounded-lg p-4 bg-white border border-gray-100 shadow-sm">
        <p class="text-xs text-gray-500 mb-1">延时增幅</p>
        <p class="text-2xl font-bold text-red-600">4.23<span class="text-base font-medium text-gray-500 ml-1">×</span></p>
        <p class="text-[11px] text-gray-400 mt-1">相对基线倍数</p>
      </div>
      <div class="rounded-lg p-4 bg-white border border-gray-100 shadow-sm">
        <p class="text-xs text-gray-500 mb-1">ADR 攻击检测率</p>
        <p class="text-2xl font-bold text-emerald-600">91.3<span class="text-base font-medium text-gray-500 ml-1">%</span></p>
        <p class="text-[11px] text-gray-400 mt-1">高检测命中率</p>
      </div>
    </div>

    <!-- 延迟对比条形图（纯 CSS 条形） -->
    <div class="mt-6 rounded-lg p-4 bg-white border border-red-100">
      <p class="text-sm font-medium text-gray-700 mb-3">推理时延对比</p>
      <div class="space-y-3">
        <div>
          <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span>基线</span><span>10.14 ms</span>
          </div>
          <div class="h-2 w-full bg-gray-100 rounded">
            <div class="h-2 bg-gray-400 rounded" style="width: 19%;"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span>Overload</span><span>42.89 ms</span>
          </div>
          <div class="h-2 w-full bg-red-100 rounded">
            <div class="h-2 bg-red-500 rounded" style="width: 80%;"></div>
          </div>
        </div>
      </div>
      <p class="mt-2 text-[11px] text-gray-400">注：条形宽度按相对比例绘制（约 1 : 4.23）。</p>
    </div>


    </div>
  </div>
</div>
`;

}
modal.classList.remove('hidden');
}
function showRepairResult(scenario) {
  const modal = document.getElementById('repairModal');
  const title = document.getElementById('repairModalTitle');
  const content = document.getElementById('repairModalContent');

  if (String(scenario) === '1') {
    // 场景1：对抗样本防御修复（完全独立）
    title.textContent = '场景1修复结果';

    content.innerHTML = `
<div class="space-y-6">
  <div class="bg-green-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4 text-green-900">对抗样本防御修复</h4>
    <div class="grid grid-cols-3 gap-6">
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">修复前精度</p>
        <p class="text-2xl font-bold text-red-600">33.47%</p>
      </div>
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">修复后精度</p>
        <p class="text-2xl font-bold text-green-600">99.18%</p>
      </div>
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">性能提升</p>
        <p class="text-2xl font-bold text-blue-600">+65.71%</p>
      </div>
    </div>
  </div>

  <div class="bg-blue-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4 text-blue-900">修复方法</h4>
    <p class="text-gray-700 bg-white p-4 rounded border-l-4 border-blue-400 mb-3">对抗性训练微调</p>
  </div>

  <div class="bg-gray-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4">修复后模型下载</h4>
    <div class="flex gap-4">
      <button id="downloadRepairedModelBtn" class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-download-line"></i></span>
        下载修复后模型
      </button>
      <button id="downloadReportBtn" class="bg-gray-600 text-white px-6 py-3 !rounded-button hover:bg-gray-700 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-file-text-line"></i></span>
        下载修复报告
      </button>
    </div>
  </div>
</div>
`;

    // 场景1：事件绑定（独立）
    const btnModel1 = content.querySelector('#downloadRepairedModelBtn');
    if (btnModel1) {
      btnModel1.addEventListener('click', function () {
        const original = this.innerHTML;
        this.disabled = true;
        this.classList.add('opacity-80', 'cursor-not-allowed');
        this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>下载中...`;
        const a = document.createElement('a');
        a.href = './src/yolov8.pt';
        a.download = 'yolov8.pt';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => {
          this.disabled = false;
          this.classList.remove('opacity-80', 'cursor-not-allowed');
          this.innerHTML = original;
        }, 800);
      });
    }

    const btnReport1 = content.querySelector('#downloadReportBtn');
    if (btnReport1) {
      btnReport1.addEventListener('click', function () {
        const original = this.innerHTML;
        this.disabled = true;
        this.classList.add('opacity-80', 'cursor-not-allowed');
        this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>生成中...`;
        const currentDate = new Date().toISOString().split('T')[0];
        const report = `修复报告（场景1：对抗样本防御修复）
生成日期: ${currentDate}

一、修复概述
- 修复前精度: 33.47%
- 修复后精度: 99.18%
- 性能提升: 65.71%

二、修复方法
- 主方法: 对抗性训练微调

`;
        const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `repair_report_s1_${currentDate}.txt`;
        document.body.appendChild(a);
        setTimeout(() => {
          a.click();
          window.URL.revokeObjectURL(url);
          a.remove();
          this.disabled = false;
          this.classList.remove('opacity-80', 'cursor-not-allowed');
          this.innerHTML = original;
        }, 500);
      });
    }

    modal.classList.remove('hidden');
    return;
  }

  if (String(scenario) === '2') {
  // 场景2：位翻转错误修复（仅展示给定信息）
  title.textContent = '场景2修复结果';

  content.innerHTML = `
<div class="space-y-6">

  <!-- 标题 -->
  <div class="rounded-xl p-6 bg-amber-50 border border-amber-100">
    <h4 class="text-lg font-semibold text-amber-900">位翻转错误修复</h4>
  </div>

  <!-- 抗扰阈值与倍数提升 -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="rounded-xl p-4 bg-white border border-gray-100">
      <p class="text-xs text-gray-500 mb-1">修复前抗扰阈值位数</p>
      <p class="text-2xl font-bold text-gray-900">14</p>
    </div>
    <div class="rounded-xl p-4 bg-white border border-gray-100">
      <p class="text-xs text-gray-500 mb-1">修复后抗扰阈值位数</p>
      <p class="text-2xl font-bold text-gray-900">317</p>
    </div>
    <div class="rounded-xl p-4 bg-white border border-gray-100">
      <p class="text-xs text-gray-500 mb-1">抗绕倍数提升</p>
      <p class="text-2xl font-bold text-emerald-600">22.64</p>
    </div>
  </div>

  <!-- mAP@.5 -->
  <div class="rounded-xl p-4 bg-white border border-gray-100">
    <p class="text-sm font-medium text-gray-900 mb-2">模型 mAP@.5</p>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <p class="text-xs text-gray-500 mb-1">修复前</p>
        <p class="text-xl font-bold text-gray-900">70.7%</p>
      </div>
      <div>
        <p class="text-xs text-gray-500 mb-1">修复后</p>
        <p class="text-xl font-bold text-gray-900">70.7%</p>
      </div>
      <div>
        <p class="text-xs text-gray-500 mb-1">性能变化</p>
        <p class="text-xl font-bold text-gray-900">-0.0%</p>
      </div>
    </div>
  </div>

  <!-- mAP@.5:.95 -->
  <div class="rounded-xl p-4 bg-white border border-gray-100">
    <p class="text-sm font-medium text-gray-900 mb-2">模型 mAP@.5:.95</p>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div>
        <p class="text-xs text-gray-500 mb-1">修复前</p>
        <p class="text-xl font-bold text-gray-900">46.0%</p>
      </div>
      <div>
        <p class="text-xs text-gray-500 mb-1">修复后</p>
        <p class="text-xl font-bold text-gray-900">45.9%</p>
      </div>
      <div>
        <p class="text-xs text-gray-500 mb-1">性能变化</p>
        <p class="text-xl font-bold text-gray-900">-0.1%</p>
      </div>
    </div>
  </div>

</div>
  <div class="bg-gray-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4">修复后模型下载</h4>
    <div class="flex gap-4">
      <button id="downloadRepairedModelBtn" class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-download-line"></i></span>
        下载修复后模型
      </button>
      <button id="downloadReportBtn" class="bg-gray-600 text-white px-6 py-3 !rounded-button hover:bg-gray-700 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-file-text-line"></i></span>
        下载修复报告
      </button>
    </div>
  </div>
</div>
`;
// 场景2：事件绑定（独立）
const btnModel2 = content.querySelector('#downloadRepairedModelBtn');
if (btnModel2) {
  btnModel2.addEventListener('click', function () {
    const original = this.innerHTML;
    this.disabled = true;
    this.classList.add('opacity-80', 'cursor-not-allowed');
    this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>下载中...`;
    const a = document.createElement('a');
    a.href = './src/yolov8.pt';
    a.download = 'yolov8.pt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => {
      this.disabled = false;
      this.classList.remove('opacity-80', 'cursor-not-allowed');
      this.innerHTML = original;
    }, 800);
  });
}

const btnReport2 = content.querySelector('#downloadReportBtn');
if (btnReport2) {
  btnReport2.addEventListener('click', function () {
    const original = this.innerHTML;
    this.disabled = true;
    this.classList.add('opacity-80', 'cursor-not-allowed');
    this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>生成中...`;
    const currentDate = new Date().toISOString().split('T')[0];
    const report = `修复报告（场景2：位翻转错误修复）
生成日期: ${currentDate}

一、修复概述
- 修复前抗扰阈值位数: 14
- 修复后抗扰阈值位数: 317
- 抗绕倍数提升: 22.64
- 修复前 mAP@.5: 70.7%
- 修复后 mAP@.5: 70.7%
- 性能变化: -0.0%
- 修复前 mAP@.5:.95: 46.0%
- 修复后 mAP@.5:.95: 45.9%
- 性能变化: -0.1%

二、修复方法
- 主方法: 错误检测纠正 + 冗余校验

`;
    const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `repair_report_s2_${currentDate}.txt`;
    document.body.appendChild(a);
    setTimeout(() => {
      a.click();
      window.URL.revokeObjectURL(url);
      a.remove();
      this.disabled = false;
      this.classList.remove('opacity-80', 'cursor-not-allowed');
      this.innerHTML = original;
    }, 500);
  });
}

  modal.classList.remove('hidden');
  return;
}

  if (String(scenario) === '3') {
    // 场景3：推理延迟优化修复（完全独立）
    title.textContent = '场景3修复结果';

    content.innerHTML = `
<div class="space-y-6">
  <div class="bg-green-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4 text-green-900">推理延迟优化修复</h4>
    <div class="grid grid-cols-3 gap-6">
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">修复前延时增幅</p>
        <p class="text-2xl font-bold text-red-600">4.23✖</p>
      </div>
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">修复后延时增幅</p>
        <p class="text-2xl font-bold text-green-600">1.94✖</p>
      </div>
      <div class="text-center">
        <p class="text-sm text-gray-600 mb-2">性能提升</p>
        <p class="text-2xl font-bold text-blue-600">+228.5%</p>
      </div>
    </div>
  </div>

  <div class="bg-blue-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4 text-blue-900">修复方法</h4>
    <p class="text-gray-700 bg-white p-4 rounded border-l-4 border-blue-400 mb-3">背景感知对抗训练</p>
  </div>

  <div class="bg-gray-50 p-6 rounded-lg">
    <h4 class="text-lg font-semibold mb-4">修复后模型下载</h4>
    <div class="flex gap-4">
      <button id="downloadRepairedModelBtn" class="bg-primary text-white px-6 py-3 !rounded-button hover:bg-blue-600 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-download-line"></i></span>
        下载修复后模型
      </button>
      <button id="downloadReportBtn" class="bg-gray-600 text-white px-6 py-3 !rounded-button hover:bg-gray-700 transition-colors whitespace-nowrap inline-flex items-center gap-2">
        <span class="w-5 h-5 flex items-center justify-center"><i class="ri-file-text-line"></i></span>
        下载修复报告
      </button>
    </div>
  </div>
</div>
`;

    // 场景3：事件绑定（独立）
    const btnModel3 = content.querySelector('#downloadRepairedModelBtn');
    if (btnModel3) {
      btnModel3.addEventListener('click', function () {
        const original = this.innerHTML;
        this.disabled = true;
        this.classList.add('opacity-80', 'cursor-not-allowed');
        this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>下载中...`;
        const a = document.createElement('a');
        a.href = './src/yolov8.pt';
        a.download = 'yolov8.pt';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => {
          this.disabled = false;
          this.classList.remove('opacity-80', 'cursor-not-allowed');
          this.innerHTML = original;
        }, 800);
      });
    }

    const btnReport3 = content.querySelector('#downloadReportBtn');
    if (btnReport3) {
      btnReport3.addEventListener('click', function () {
        const original = this.innerHTML;
        this.disabled = true;
        this.classList.add('opacity-80', 'cursor-not-allowed');
        this.innerHTML = `<span class="w-5 h-5 flex items-center justify-center"><i class="ri-loader-4-line animate-spin"></i></span>生成中...`;
        const currentDate = new Date().toISOString().split('T')[0];
        const report = `修复报告（场景3：推理延迟优化修复）
生成日期: ${currentDate}

一、修复概述
- 修复前延时增幅: 4.23✖
- 修复后延时增幅: 1.94✖
- 性能提升: 228.5%

二、修复方法
- 修复主方法: 背景感知对抗训练

`;
        const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `repair_report_s3_${currentDate}.txt`;
        document.body.appendChild(a);
        setTimeout(() => {
          a.click();
          window.URL.revokeObjectURL(url);
          a.remove();
          this.disabled = false;
          this.classList.remove('opacity-80', 'cursor-not-allowed');
          this.innerHTML = original;
        }, 500);
      });
    }

    modal.classList.remove('hidden');
    return;
  }
}
});
</script>
</body>
</html>